flowchart TD
    A([Start]) --> B[Initialize: grid, snake, food, score=0, speed]
    B --> C{Main Loop Tick}

    C --> D[Read input]
    D --> E{Pause / Resume / Quit?}
    E -- Pause --> P[State = Paused; show overlay]
    P --> PR{Resume or Quit?}
    PR -- Resume --> C
    PR -- Quit --> Z([End])

    E -- No --> F["Validate direction (no 180Â° turn)"]
    F --> G[Compute nextHead = head + dir]

    G --> H{Wall policy}
    H -- WRAP --> I[Wrap nextHead across edges]
    H -- BOUNDED --> I2[Keep nextHead as is]

    I --> J{Out of bounds?}
    I2 --> J{Out of bounds?}
    J -- Yes --> GO1[Cause: Hit wall] --> GO[Game Over]
    J -- No --> K{Self collision?}
    K -- Yes --> GO2[Cause: Hit self] --> GO

    K -- No --> L{Is nextHead on food?}
    L -- Yes --> M[Grow: add head, keep tail; score += 1]
    M --> N[Respawn food at random empty cell]
    N --> R["Render frame (snake, food, HUD)"]

    L -- No --> Q[Move: add head, remove tail]
    Q --> R["Render frame (snake, food, HUD)"]

    R --> C

    GO --> HS[Update highScore if needed]
    HS --> O[Show Game Over overlay: score, highScore, cause]
    O --> S{Restart?}
    S -- Yes --> B
    S -- No --> Z([End])